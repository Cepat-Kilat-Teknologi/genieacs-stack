# GenieACS Docker Deployment

![Docker](https://img.shields.io/badge/Docker-%E2%9C%93-blue?style=flat-square)
![MongoDB](https://img.shields.io/badge/MongoDB-8.0-green?style=flat-square)
![GenieACS](https://img.shields.io/badge/GenieACS-1.2.13-orange?style=flat-square)

Docker container for deployment GenieACS v1.2.13 with MongoDB 8.0, optimized for production use with security hardening, health checks, and log management.

## ğŸ“‹ Features
- âœ… GenieACS v1.2.13  (CWMP, NBI, FS, UI)
- âœ… MongoDB 8.0 with health check
- âœ… Multi-architecture support (amd64/arm64)
- âœ… Security hardened image
- âœ… Auto-restart and health monitoring
- âœ… Log rotation support
- âœ… Data persistence with Docker volumes
- âœ… Environment variables configuration

## ğŸš€ Quick Start

### Prerequisites
- Docker & Docker Compose
- Git
- Make (optional)

### 1. Setup Configuration
The first step to take is to prepare the configuration:

```bash
# Setup Configuration files
make setup
```

This command will create:
- `genieacs.logrotate` - Configuration for log rotation
- `config/` directory - For GenieACS configuration files
- `ext/` directory - For extensions GenieACS

### 2. Full Installation & Run
```bash
# Setup Configuration (if not done yet)
make setup

# Build Docker image
make build

# Run all services
make up

# Check status services
make status

# Open http://localhost:3000
# Login: admin / admin
```

## ğŸ“ Structure Project
```
.
â”œâ”€â”€ Dockerfile              # Docker build configuration
â”œâ”€â”€ Makefile               # Build and management commands
â”œâ”€â”€ docker-compose.yml     # Service orchestration
â”œâ”€â”€ .dockerignore          # Docker ignore patterns
â”œâ”€â”€ .gitignore            # Git ignore patterns
â”œâ”€â”€ genieacs.logrotate    # Log rotation config
â”œâ”€â”€ mongo-init.js         # MongoDB initialization
â”œâ”€â”€ config/               # Configuration directory
â”‚   â”œâ”€â”€ config.json       # GenieACS config
â”‚   â””â”€â”€ env.json          # Environment variables
â””â”€â”€ ext/                  # GenieACS extensions directory
```

## ğŸ› ï¸ Management Commands

### Build & Deployment
```bash
# Setup configuration files 
make setup

# Build image for current architecture
make build

# Build multi-platform image
make buildx

# Push image ke registry
make push

# Run services in background
make up

# Stop dan remove services
make down

# See real-time logs
make logs
```

### Maintenance & Monitoring
```bash
# Status services
make status

# Test health services
make test

# Restart services
make restart

# Cleanup resources
make clean

# Scan vulnerabilities image
make scan

# Verify dependencies versions
make verify-deps
```

### Development & Debugging
```bash
# Build with security features
make secure-build

# Show running processes
make ps

# Open GenieACS UI in browser
# (After 'make up' command)
# Buka: http://localhost:3000
```

## âš™ï¸ Configuration

### Environment Variables
**GenieACS Service**:
```yaml
GENIEACS_UI_JWT_SECRET: kmzway87aa
GENIEACS_MONGODB_CONNECTION_URL: mongodb://mongo:27017/genieacs
NODE_ENV: production
```

**File Configuration** (generated by `make setup`):
- `config/env.json` - Environment variables
- `config/config.json` - Service configuration
- `genieacs.logrotate` - Log rotation rules

### Port Mapping
| Service | Port | Protocol | Description              |
|---------|------|----------|--------------------------|
| CWMP    | 7547 | TCP      | TR-069/CPE Management    |
| NBI     | 7557 | TCP      | Northbound Interface     |
| FS      | 7567 | TCP      | File Server              |
| UI      | 3000 | TCP      | Web Interface            |

## ğŸ” Security Features
- Non-root user execution
- Automated security updates
- Vulnerability scanning integrated
- Minimal package installation
- Log rotation and management
- Health check monitoring

## ğŸ³ Docker Images
- **Base Image**: `debian:stable-slim`
- **Node.js Version**: LTS (from `node:lts-slim`)
- **MongoDB Version**: 8.0
- **Image Tags**:
    - `cepatkilatteknologi/genieacs:v1.2.13`
    - `cepatkilatteknologi/genieacs:latest`

## ğŸ“Š Monitoring & Health Checks

### Health Checks
**MongoDB**:
```bash
# Test MongoDB connection
docker exec mongo-genieacs mongosh --eval "db.adminCommand('ping')"
```

**GenieACS UI**:
```bash
# Test GenieACS UI health
curl -f http://localhost:3000/
```

### Logs Management
```bash
# View all logs real-time
make logs

# View MongoDB logs only
docker logs mongo-genieacs -f

# View GenieACS logs only
docker logs genieacs -f

# Check logs directory
ls -la /var/log/genieacs/
```

## ğŸ—‚ï¸ Volumes & Data Persistence
| Volume                  | Description                   | Location            |
|-------------------------|-------------------------------|---------------------|
| genieacs-mongo-data     | MongoDB data storage          | /data/db            |
| genieacs-mongo-configdb | MongoDB config storage        | /data/configdb      |
| genieacs-app-data       | GenieACS application data     | /opt/genieacs       |
| genieacs-logs           | Application logs              | /var/log/genieacs   |

## ğŸ”§ Troubleshooting

### Common Issues & Solutions
**Port already in use**:
```bash
# Check port usage
lsof -i :3000
lsof -i :7547
```

**MongoDB connection issues**:
```bash
# Test MongoDB connection
docker exec mongo-genieacs mongosh --eval "db.adminCommand('ping')"

# Check MongoDB logs
docker logs mongo-genieacs
```

**Build failures**:
```bash
# Clean build artifacts
make clean
make build
```

**Login issues (username/password)**:
```bash
# Reset admin password
docker exec mongo-genieacs mongosh genieacs --eval '
  db.users.updateOne(
    { _id: "admin" },
    { $set: {
      password: "$2a$08$r.j7.zbgR5sBfOqLkqPvE.7b1c9d2e3f4g5h6i7j8k9l0m1n2o3p4q",
      salt: "$2a$08$r.j7.zbgR5sBfOqLkqPvE.",
      roles: ["admin"]
    }},
    { upsert: true }
  )
'
# Login with: admin / admin
```

### Debug Commands
```bash
# Login to container GenieACS
docker exec -it genieacs /bin/bash

# Check service status
supervisorctl status

# Test binary paths
which genieacs-cwmp
which genieacs-nbi
which genieacs-fs
which genieacs-ui

# Check environment variables
env | grep GENIEACS
```

## ğŸ“ Changelog
### v1.2.13
- Initial GenieACS v1.2.13 release
- MongoDB 8.0 support
- Multi-architecture build support
- Security vulnerability fixes
- Health check integration
- Automated setup process

## ğŸš¨ Important Notes
- Run `make setup` will overwrite existing config files.
- Default login: username: `admin`, password: `admin`.
- Change `GENIEACS_UI_JWT_SECRET` for production environment.
- Backup volumes every month or as needed.
- Monitor logs for debugging and performance tuning.

## ğŸ¤ Contributing
1. Fork the project.
2. Create your feature branch (`git checkout -b feature/YourFeature`).
3. Commit your changes (`git commit -m 'Add YourFeature'`).
4. Push to the branch (`git push origin feature/YourFeature`).
5. Create a Pull Request.

## ğŸ“„ License
This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## ğŸ™ Acknowledgments
- [GenieACS](https://github.com/genieacs/genieacs) - Open source ACS server
- [Docker](https://www.docker.com/) - Container platform
- [MongoDB](https://www.mongodb.com/) - Database solution

## ğŸ“ Support
For support, please contact:
- **Email**: info@ckt.co.id
- **Issues**: [GitHub Issues page](https://github.com/cepatkilatteknologi/genieacs/issues)

âš ï¸ **Important**: Always ensure to keep your Docker images and containers updated to the latest versions for security and performance improvements.