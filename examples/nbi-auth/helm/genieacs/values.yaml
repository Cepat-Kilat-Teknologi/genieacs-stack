# Default values for genieacs with NBI authentication.

# Global settings
nameOverride: ""
fullnameOverride: ""

# GenieACS Application
genieacs:
  image:
    repository: cepatkilatteknologi/genieacs
    tag: latest
    pullPolicy: IfNotPresent

  replicaCount: 1

  # Service configuration
  service:
    type: LoadBalancer
    # Fixed LoadBalancer IP (for MetalLB or similar)
    # loadBalancerIP: "10.100.0.250"
    # IP whitelist - only these IPs can access
    # loadBalancerSourceRanges:
    #   - "10.0.0.0/8"
    #   - "192.168.0.0/16"
    # Custom annotations (for cloud providers)
    # annotations:
    #   service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
    #   service.beta.kubernetes.io/azure-load-balancer-internal: "true"
    ports:
      cwmp: 7547
      nbi: 7557    # External port (routes to nginx proxy)
      fs: 7567
      ui: 3000

  # Resource limits
  resources:
    requests:
      cpu: "250m"
      memory: "256Mi"
    limits:
      cpu: "2000m"
      memory: "1Gi"

  # Persistence for logs and extensions
  persistence:
    logs:
      enabled: true
      size: 5Gi
      storageClass: ""
      accessMode: ReadWriteOnce
    ext:
      enabled: true
      size: 1Gi
      storageClass: ""
      accessMode: ReadWriteOnce

  # Probes
  livenessProbe:
    initialDelaySeconds: 90
    periodSeconds: 30
    timeoutSeconds: 10
    failureThreshold: 5

  readinessProbe:
    initialDelaySeconds: 60
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  # Security context
  securityContext:
    allowPrivilegeEscalation: false

  # Init container images
  initContainers:
    busybox:
      image: busybox
      tag: "1.36"

# NBI Authentication Proxy (Nginx sidecar)
nbiAuth:
  enabled: true
  image:
    repository: nginx
    tag: "1.27-alpine"
    pullPolicy: IfNotPresent

  # Use an existing secret for API key instead of creating one
  # If set, the chart will NOT create nbi-auth secret and will use this existing secret
  # The existing secret must contain: NBI_API_KEY
  existingSecret: ""

  # API Key for NBI authentication (ignored if existingSecret is set)
  # Generate with: openssl rand -hex 32
  apiKey: "changeme-generate-with-openssl-rand-hex-32"

  # Internal port (nginx listens on this)
  internalPort: 7558

  # Resource limits
  resources:
    requests:
      cpu: "50m"
      memory: "32Mi"
    limits:
      cpu: "200m"
      memory: "64Mi"

# GenieACS Configuration
config:
  # MongoDB connection URL (uses internal service name by default)
  mongodbConnectionUrl: "mongodb://mongodb:27017/genieacs"
  # Enable UI authentication
  uiAuth: "true"
  # Extensions directory
  extDir: "/opt/genieacs/ext"
  # Node environment
  nodeEnv: "production"

# GenieACS Secret
secret:
  # Use an existing secret instead of creating one
  # If set, the chart will NOT create a secret and will use this existing secret
  # The existing secret must contain: GENIEACS_UI_JWT_SECRET
  existingSecret: ""

  # JWT secret for UI authentication (ignored if existingSecret is set)
  # Generate with: openssl rand -hex 32
  jwtSecret: "changeme-generate-with-openssl-rand-hex-32"

# MongoDB Configuration
mongodb:
  enabled: true

  image:
    repository: mongo
    tag: "8.0"
    pullPolicy: IfNotPresent

  replicaCount: 1

  service:
    type: ClusterIP
    port: 27017

  # Resource limits
  resources:
    requests:
      cpu: "250m"
      memory: "512Mi"
    limits:
      cpu: "2000m"
      memory: "2Gi"

  # Persistence
  persistence:
    data:
      enabled: true
      size: 10Gi
      storageClass: ""
      accessMode: ReadWriteOnce
    configdb:
      enabled: true
      size: 1Gi
      storageClass: ""
      accessMode: ReadWriteOnce

  # Probes
  livenessProbe:
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 6

  readinessProbe:
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

# Service Account
serviceAccount:
  create: false
  name: ""
  annotations: {}

# Pod annotations
podAnnotations: {}

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity: {}